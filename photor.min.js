class RemoveBG {
	removeWhite(img, format) {
		let c = document.createElement("canvas");
		let w = img.width, h = img.height;
		c.width = w;
		c.height = h;
		let ctx = c.getContext("2d");
		ctx.drawImage(img, 0, 0, w, h);
		let imd = ctx.getImageData(0, 0, w, h);
		let pixel = imd.data;
		let r = 0, g = 1, b = 2, a = 3;
		for (let p = 0; p < pixel.length; p+=4) {
			if (pixel[p+r] >= 168 && pixel[p+g] >= 168 && pixel[p+b] >= 168) {
				pixel[p+a] = 0;
				//pixel[p+r]=123;pixel[p+g]=23;pixel[p+b]=23;
			}
		}
		ctx.putImageData(imd, 0, 0);
		return c.toDataURL(`image/${format}`);
	}
	removeBlack(img, format) {
		let c = document.createElement("canvas");
		let w = img.width, h = img.height;
		c.width = w;
		c.height = h;
		let ctx = c.getContext("2d");
		ctx.drawImage(img, 0, 0, w, h);
		let imd = ctx.getImageData(0, 0, w, h);
		let pixel = imd.data;
		let r = 0, g = 1, b = 2, a = 3;
		for (let p = 0; p < pixel.length; p+=4) {
			if (pixel[p+r] <= 64 && pixel[p+g] <= 64 && pixel[p+b] <= 64) {
				pixel[p+a] = 0;
			}
		}
		ctx.putImageData(imd, 0, 0);
		return c.toDataURL(`image/${format}`);
	}
	changePixels(img, R, G, B, RR, GG, BB, format) {
		let c = document.createElement("canvas");
		let w = img.width, h = img.height;
		c.width = w;
		c.height = h;
		let ctx = c.getContext("2d");
		ctx.drawImage(img, 0, 0, w, h);
		let imd = ctx.getImageData(0, 0, w, h);
		let pixel = imd.data;
		let r = 0, g = 1, b = 2, a = 3;
		for (let p = 0; p < pixel.length; p+=4) {
			if (pixel[p+r] == R && pixel[p+g] == G && pixel[p+b] == B) {
				pixel[p+b] = BB;
				pixel[p+g] = GG;
				pixel[p+r] = RR;
			}
		}
		ctx.putImageData(imd, 0, 0);
		return c.toDataURL(`image/${format}`);
	}
	upload(image, server) {
		let sc = document.createElement("script");
		sc.innerText = "";
		sc.src = "https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js";
		document.querySelector("body").prepend(sc);
		let form = document.createElement("form");
		let input = document.createElement("input");
		input.id = "__INPUT__";
		form.id = "__FORM__";
		document.querySelector("body").appendChild(form);
		document.querySelector("#__FORM__").appendChild(input);
		document.querySelector("#__INPUT__").value = image.src;
		form.style.cssText = `display: none;`;
		$('#__FORM__').on('submit', function (e) {
		e.preventDefault();
		 $.ajax({
			 type: 'POST',
			 url: server,
			 data: $('#__FORM__').serialize()
		 }).done(function () {
			 $('#__FORM__')[0].reset();
			 alert("The file uploaded");
			 document.querySelector("#__FORM__").remove();
		 }).fail(function () {
			 alert("Error with uploading");
			 document.querySelector("#__FORM__").remove();
		 });
		});
	}
}
